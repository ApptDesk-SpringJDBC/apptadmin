$("#exportDataTableToCSV").die("click"),$("#exportDataTableToCSV").live("click",function(){var e=$(this).attr("tablename"),t=$(this).attr("fileName");$("#"+e).tableExport({type:"csv",tableName:t})}),function(e){e.fn.extend({tableExport:function(t){function n(e){return content_data="true"==i.htmlContent?e.html().trim():e.text().trim(),"true"==i.escape&&(content_data=escape(content_data)),content_data}var i={separator:",",ignoreColumn:[],tableName:"yourTableName",type:"csv",pdfFontSize:14,pdfLeftMargin:20,escape:"true",htmlContent:"false",consoleLog:"false"},t=e.extend(i,t),a=this;if("csv"==i.type||"txt"==i.type){var o="";e(a).find("thead").find("tr").each(function(){o+="\n",e(this).filter(":visible").find("th").each(function(t){"none"!=e(this).css("display")&&-1==i.ignoreColumn.indexOf(t)&&(o+='"'+e(this).text()+'"'+i.separator)}),o=e.trim(o),o=e.trim(o).substring(0,o.length-1)});var s=e(a).dataTable(),d=s.fnGetNodes();e.each(d,function(){o+="\n",e(this).find("td").each(function(t){"none"!=e(this).css("display")&&-1==i.ignoreColumn.indexOf(t)&&(o+='"'+e(this).text()+'"'+i.separator)}),o=e.trim(o).substring(0,o.length-1).replace("'","")}),"true"==i.consoleLog&&console.log(o);var l=window.navigator.userAgent,r=l.indexOf("MSIE"),c="";if(c=r>0?parseInt(l.substring(r+5,l.indexOf(".",r))):navigator.userAgent.match(/Trident\/7\./)?11:0,c>0)e("<form>",{html:"<input type='hidden' name='type' value='site_csv' /><input type='hidden' name='name' value='"+i.tableName+"' /><input type='hidden' name='source' value='source' /><input type='hidden' name='exportData' value='"+o+"'/>",action:jsContextPath+"/TableExport",method:"post"}).appendTo(document.body).submit();else{var f=document.createElement("a");f.href="data:application/csv;charset=utf-8,"+encodeURIComponent(o),f.target="_blank",f.download=i.tableName+".csv",document.body.appendChild(f),f.click()}}else if("sql"==i.type){var o="INSERT INTO `"+i.tableName+"` (";e(a).find("thead").find("tr").each(function(){e(this).filter(":visible").find("th").each(function(t){"none"!=e(this).css("display")&&-1==i.ignoreColumn.indexOf(t)&&(o+="`"+n(e(this))+"`,")}),o=e.trim(o),o=e.trim(o).substring(0,o.length-1)}),o+=") VALUES ",e(a).find("tbody").find("tr").each(function(){o+="(",e(this).filter(":visible").find("td").each(function(t){"none"!=e(this).css("display")&&-1==i.ignoreColumn.indexOf(t)&&(o+='"'+n(e(this))+'",')}),o=e.trim(o).substring(0,o.length-1),o+="),"}),o=e.trim(o).substring(0,o.length-1),o+=";","true"==i.consoleLog&&console.log(o);var h="base64,"+e.base64.encode(o);window.open("data:application/sql;filename=exportData;"+h)}else if("json"==i.type){var p=[];e(a).find("thead").find("tr").each(function(){var t=[];e(this).filter(":visible").find("th").each(function(a){"none"!=e(this).css("display")&&-1==i.ignoreColumn.indexOf(a)&&t.push(n(e(this)))}),p.push(t)});var u=[];e(a).find("tbody").find("tr").each(function(){var t=[];e(this).filter(":visible").find("td").each(function(a){"none"!=e(this).css("display")&&-1==i.ignoreColumn.indexOf(a)&&t.push(n(e(this)))}),u.push(t)});var m=[];m.push({header:p,data:u}),"true"==i.consoleLog&&console.log(JSON.stringify(m));var h="base64,"+e.base64.encode(JSON.stringify(m));window.open("data:application/json;filename=exportData;"+h)}else if("xml"==i.type){var x='<?xml version="1.0" encoding="utf-8"?>';x+="<tabledata><fields>",e(a).find("thead").find("tr").each(function(){e(this).filter(":visible").find("th").each(function(t){"none"!=e(this).css("display")&&-1==i.ignoreColumn.indexOf(t)&&(x+="<field>"+n(e(this))+"</field>")})}),x+="</fields><data>";var b=1;e(a).find("tbody").find("tr").each(function(){x+='<row id="'+b+'">';var t=0;e(this).filter(":visible").find("td").each(function(a){"none"!=e(this).css("display")&&-1==i.ignoreColumn.indexOf(a)&&(x+="<column-"+t+">"+n(e(this))+"</column-"+t+">"),t++}),b++,x+="</row>"}),x+="</data></tabledata>","true"==i.consoleLog&&console.log(x);var h="base64,"+e.base64.encode(x);window.open("data:application/xml;filename=exportData;"+h)}else if("excel"==i.type||"doc"==i.type||"powerpoint"==i.type){var g="<table>";e(a).find("thead").find("tr").each(function(){g+="<tr>",e(this).filter(":visible").find("th").each(function(t){"none"!=e(this).css("display")&&-1==i.ignoreColumn.indexOf(t)&&(g+="<td>"+n(e(this))+"</td>")}),g+="</tr>"});var b=1;e(a).find("tbody").find("tr").each(function(){g+="<tr>";var t=0;e(this).filter(":visible").find("td").each(function(a){"none"!=e(this).css("display")&&-1==i.ignoreColumn.indexOf(a)&&(g+="<td>"+n(e(this))+"</td>"),t++}),b++,g+="</tr>"}),g+="</table>","true"==i.consoleLog&&console.log(g);var v="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:"+i.type+"' xmlns='http://www.w3.org/TR/REC-html40'>";v+="<head>",v+="<!--[if gte mso 9]>",v+="<xml>",v+="<x:ExcelWorkbook>",v+="<x:ExcelWorksheets>",v+="<x:ExcelWorksheet>",v+="<x:Name>",v+="{worksheet}",v+="</x:Name>",v+="<x:WorksheetOptions>",v+="<x:DisplayGridlines/>",v+="</x:WorksheetOptions>",v+="</x:ExcelWorksheet>",v+="</x:ExcelWorksheets>",v+="</x:ExcelWorkbook>",v+="</xml>",v+="<![endif]-->",v+="</head>",v+="<body>",v+=g,v+="</body>",v+="</html>";var h="base64,"+e.base64.encode(v);document.getElementById("dlink").href="data:application/vnd.ms-"+i.type+";filename="+i.tableName.toString()+";"+h,document.getElementById("dlink").download=i.tableName.toString()+".xlsx",document.getElementById("dlink").click()}else if("png"==i.type)html2canvas(e(a),{onrendered:function(e){var t=e.toDataURL("image/png");window.open(t)}});else if("pdf"==i.type){var y=new jsPDF("p","pt","a4",!0);y.setFontSize(i.pdfFontSize);var w=i.pdfLeftMargin;e(a).find("thead").find("tr").each(function(){e(this).filter(":visible").find("th").each(function(t){if("none"!=e(this).css("display")&&-1==i.ignoreColumn.indexOf(t)){var a=w+50*t;y.text(a,20,n(e(this)))}})});var C=20,k=1,O=0;e(a).find("tbody").find("tr").each(function(t){rowCalc=t+1,rowCalc%26==0&&(y.addPage(),k++,C+=10),O=C+10*rowCalc-280*(k-1),e(this).filter(":visible").find("td").each(function(t){if("none"!=e(this).css("display")&&-1==i.ignoreColumn.indexOf(t)){var a=w+50*t;y.text(a,O,n(e(this)))}})}),y.output("datauri")}}})}(jQuery);